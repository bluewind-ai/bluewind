{% extends "admin/base.html" %}

{% load static %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block extrastyle %}
{{ block.super }}
<link href="https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/9.9.2/jsoneditor.min.css" rel="stylesheet" type="text/css">
{% endblock %}

{% block branding %}
<h1 id="site-name"><a href="{% url 'admin:index' %}">{{ site_header|default:_('Django administration') }}</a></h1>
{% endblock %}

{% block nav-global %}
{{ block.super }}
<button id="toggleButton" onclick="toggleSite()" style="margin-left: 10px;">G</button>
{% endblock %}

{% block footer %}
    {{ block.super }}
    {% include 'json_editor.html' %}

    <!-- Embed data for JavaScript -->
    {% if flows_data %}
        {{ flows_data|json_script:"initial-data" }}
    {% else %}
        <script>console.log('flows_data is not available in the context');</script>
    {% endif %}

    <script>
        const initialDataElement = document.getElementById('initial-data');
        try {
            const initialData = JSON.parse(initialDataElement ? initialDataElement.textContent : '{}');
            window.initialData = {
                flows: initialData || []
            };
        } catch (error) {
            window.initialData = { flows: [] };
        }

        let isGoogle = true;
        function toggleSite() {
            const button = document.getElementById('toggleButton');
            if (isGoogle) {
                window.open('http://www.facebook.com', '_blank');
                button.textContent = 'F';
            } else {
                window.open('https://www.google.com', '_blank');
                button.textContent = 'M';
            }
            isGoogle = !isGoogle;
        }
    </script>

    <script src="{% static 'bluewind/js/admin_shortcuts.js' %}"></script>
{% endblock %}
