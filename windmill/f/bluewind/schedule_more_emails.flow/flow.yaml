summary: schedule_more_emails
description: ''
value:
  modules:
    - id: bx
      summary: Fetch twenty api key
      value:
        type: flow
        input_transforms: {}
        path: f/bluewind/fetch_twenty_api_key
    - id: cu
      summary: fetch smartlead api key
      value:
        type: flow
        input_transforms: {}
        path: f/bluewind/fetch_smartlead_api_key
    - id: dw
      summary: Create Campaign Object
      value:
        type: rawscript
        content: '!inline create_campaign_object.inline_script.native.ts'
        input_transforms:
          twenty_api_key:
            type: javascript
            expr: results.bx.twenty_api_key
        lock: ''
        language: nativets
    - id: dx
      summary: Create Campaign People Object
      value:
        type: rawscript
        content: '!inline create_campaign_people_object.inline_script.native.ts'
        input_transforms:
          twenty_api_key:
            type: javascript
            expr: results.bx.twenty_api_key
        lock: ''
        language: nativets
    - id: br
      summary: Fetch Campaigns
      value:
        type: flow
        input_transforms:
          twenty_api_key:
            type: javascript
            expr: results.bx.twenty_api_key
        path: f/bluewind/immaculate_flow
      continue_on_error: false
    - id: ci
      summary: get id of the person object
      value:
        type: rawscript
        content: '!inline get_id_of_the_person_object.inline_script.native.ts'
        input_transforms:
          twenty_api_key:
            type: javascript
            expr: '`${results.bx.twenty_api_key}`'
        lock: ''
        language: nativets
        tag: ''
    - id: dr
      summary: create or update isEmailValid
      value:
        type: flow
        input_transforms:
          field_medatadata:
            type: javascript
            expr: |-
              {
                description: null,
                icon: "IconUsers",
                label: "Is Email Valid",
                name: "isEmailValid",
                objectMetadataId: results.ci.person_obect_metadata,
                type: "BOOLEAN"
              }
          twenty_api_key:
            type: javascript
            value: '${results.bx.twenty_api_key}'
            expr: '`${results.bx.twenty_api_key}`'
        path: f/bluewind/create_or_update_twenty_field
    - id: ds
      summary: create or update isEmailCatchAll
      value:
        type: flow
        input_transforms:
          field_medatadata:
            type: javascript
            expr: |-
              {
                      description: null,
                      icon: "IconUsers",
                      label: "Is Email Catch All",
                      name: "isEmailCatchAll",
                      objectMetadataId: results.ci.person_obect_metadata,
                      type: "BOOLEAN"
                    }
          twenty_api_key:
            type: javascript
            value: '${results.bx.twenty_api_key}'
            expr: '`${results.bx.twenty_api_key}`'
        path: f/bluewind/create_or_update_twenty_field
    - id: cw
      summary: get id of the campaign object
      value:
        type: rawscript
        content: '!inline get_id_of_the_campaign_object.inline_script.native.ts'
        input_transforms:
          twenty_api_key:
            type: javascript
            expr: '`${results.bx.twenty_api_key}`'
        lock: ''
        language: nativets
        tag: ''
    - id: cv
      summary: Create campaign custom fields
      value:
        type: rawscript
        content: '!inline create_campaign_custom_fields.inline_script.native.ts'
        input_transforms:
          campaign_obect_metadata:
            type: javascript
            expr: '`${results.cw.campaign_object_metadata}`'
          twenty_api_key:
            type: javascript
            expr: '`${results.bx.twenty_api_key}`'
        lock: ''
        language: nativets
        tag: ''
    - id: dv
      summary: get id of the campaignpeople object
      value:
        type: rawscript
        content: '!inline get_id_of_the_campaignpeople_object.inline_script.native.ts'
        input_transforms:
          twenty_api_key:
            type: javascript
            expr: results.bx.twenty_api_key
        lock: ''
        language: nativets
    - id: du
      summary: Create relation CampaignPeople.person
      value:
        type: rawscript
        content: '!inline create_relation_campaignpeople.person.inline_script.native.ts'
        input_transforms:
          campaign_people_object_id:
            type: javascript
            expr: results.dv.campaign_people_object_metadata
          person_object_id:
            type: javascript
            expr: results.ci.person_obect_metadata
          twenty_api_key:
            type: javascript
            expr: results.bx.twenty_api_key
        lock: ''
        language: nativets
      continue_on_error: false
    - id: dt
      summary: create or update CampaignStatus
      value:
        type: flow
        input_transforms:
          field_medatadata:
            type: javascript
            expr: |-
              {
                "description": "Status of this contact in the curent campaign",
                "icon": "IconUsers",
                "label": "Campaign Status",
                "name": "campaignStatus",
                "options": [
                  {
                    "color": "blue",
                    "id": "5817df78-228d-4d17-a7eb-7875d380034d",
                    "label": "Sourced",
                    "position": 0,
                    "value": "SOURCED"
                  },
                  {
                    "color": "turquoise",
                    "id": "cd2d4f3f-1404-483a-acf7-935b06fea8d8",
                    "label": "Unqualified",
                    "position": 1,
                    "value": "UNQUALIFIED"
                  },
                  {
                    "color": "green",
                    "id": "ccf00459-c395-4c7f-aaa0-44cf960805e9",
                    "label": "Email Scheduled",
                    "position": 2,
                    "value": "EMAIL_SCHEDULED"
                  }
                ],
                "objectMetadataId": results.dv.campaign_people_object_metadata,
                "type": "SELECT"
              }
          twenty_api_key:
            type: javascript
            value: '${results.bx.twenty_api_key}'
            expr: '`${results.bx.twenty_api_key}`'
        path: f/bluewind/create_or_update_twenty_field
    - id: cf
      summary: create person custom fields
      value:
        type: rawscript
        content: '!inline create_person_custom_fields.inline_script.native.ts'
        input_transforms:
          person_obect_metadata:
            type: javascript
            expr: results.ci.person_obect_metadata
          twenty_api_key:
            type: javascript
            expr: '`${results.bx.twenty_api_key}`'
        lock: ''
        language: nativets
        tag: ''
    - id: bp
      summary: ''
      value:
        type: branchone
        branches:
          - summary: If no campaign exists
            modules:
              - id: bf
                summary: Prompt campaign name
                value:
                  type: rawscript
                  content: '!inline prompt_campaign_name.inline_script.ts'
                  input_transforms:
                    campaigns:
                      type: static
                      value: null
                  lock: '!inline prompt_campaign_name.inline_script.lock'
                  language: deno
                  path: hub/8713/windmill/default_arguments_in_approval_steps
                  tag: ''
                continue_on_error: false
                suspend:
                  required_events: 1
                  resume_form:
                    schema:
                      $schema: 'https://json-schema.org/draft/2020-12/schema'
                      type: object
                      order:
                        - campaign_name
                      properties:
                        campaign_name:
                          type: string
                          description: ''
                          default: ''
                      required: []
                  timeout: 1800
              - id: ca
                summary: Create campaign on Twenty
                value:
                  type: rawscript
                  content: '!inline create_campaign_on_twenty.inline_script.native.ts'
                  input_transforms:
                    campaign_name:
                      type: javascript
                      expr: resume.campaign_name
                    twenty_api_key:
                      type: javascript
                      expr: '`${results.bx.twenty_api_key}`'
                  lock: ''
                  language: nativets
                  tag: ''
            expr: results.br.data.campaigns.length === 0
            parallel: true
            skip_failure: true
        default:
          - id: bq
            summary: Ask campaign to pick
            value:
              type: rawscript
              content: '!inline ask_campaign_to_pick.inline_script.ts'
              input_transforms:
                campaigns:
                  type: javascript
                  expr: results.br.data.campaigns
              lock: '!inline ask_campaign_to_pick.inline_script.lock'
              language: deno
              path: hub/8713/windmill/default_arguments_in_approval_steps
              tag: ''
            continue_on_error: false
            suspend:
              hide_cancel: false
              required_events: 1
              resume_form:
                schema:
                  $schema: 'https://json-schema.org/draft/2020-12/schema'
                  type: object
                  order:
                    - campaign_to_pick
                  properties:
                    campaign_to_pick:
                      type: string
                      description: ''
                      default: ''
                  required: []
              timeout: 1800
          - id: cy
            summary: Filter by the campaign name
            value:
              type: rawscript
              content: '!inline filter_by_the_campaign_name.inline_script.native.ts'
              input_transforms:
                campaign_name:
                  type: javascript
                  expr: resume.campaign_to_pick
                campaigns:
                  type: javascript
                  expr: results.br.data.campaigns
              lock: ''
              language: nativets
              tag: ''
    - id: cz
      summary: ''
      value:
        type: branchone
        branches:
          - summary: if no campaign created on smartlead
            modules:
              - id: do
                summary: create campaign and link to twenty
                value:
                  type: flow
                  input_transforms:
                    campaign_name:
                      type: javascript
                      value: ''
                      expr: results.bp.name
                    smartlead_api_key:
                      type: javascript
                      value: ''
                      expr: results.cu.smartlead_api_key
                    twenty_api_key:
                      type: javascript
                      value: ''
                      expr: results.bx.twenty_api_key
                    twenty_campaign_id:
                      type: javascript
                      value: ''
                      expr: results.bp.id
                  path: f/bluewind/create_campaign_and_link_twenty
            expr: >-
              results.bp.smartleadCampaignId === undefined ||
              results.bp.smartleadCampaignId === null ||
              results.bp.smartleadCampaignId === ""
            parallel: true
            skip_failure: true
        default:
          - id: dm
            summary: Get campaign on smartlead
            value:
              type: rawscript
              content: '!inline get_campaign_on_smartlead.inline_script.native.ts'
              input_transforms:
                smartlead_api_key:
                  type: javascript
                  expr: '`${results.cu.smartlead_api_key}`'
                smartlead_campaign_id:
                  type: javascript
                  expr: results.bp.smartleadCampaignId
              lock: ''
              language: nativets
              tag: ''
          - id: dp
            summary: ''
            value:
              type: branchone
              branches:
                - summary: If campaign not found
                  modules:
                    - id: dq
                      summary: create campaign and link to twenty
                      value:
                        type: flow
                        input_transforms:
                          campaign_name:
                            type: javascript
                            expr: results.bp.name
                          smartlead_api_key:
                            type: javascript
                            expr: results.cu.smartlead_api_key
                          twenty_api_key:
                            type: javascript
                            expr: results.bx.twenty_api_key
                          twenty_campaign_id:
                            type: javascript
                            expr: results.bp.id
                        path: f/bluewind/create_campaign_and_link_twenty
                  expr: results.dm.error !== undefined
                  parallel: true
                  skip_failure: true
              default:
                - id: db
                  summary: get smartlead campaign id
                  value:
                    type: rawscript
                    content: '!inline get_smartlead_campaign_id.inline_script.native.ts'
                    input_transforms:
                      campaign:
                        type: javascript
                        expr: results.bp
                    lock: ''
                    language: nativets
                    tag: ''
    - id: cq
      summary: Ask campaign info
      value:
        type: rawscript
        content: '!inline ask_campaign_info.inline_script.ts'
        input_transforms: {}
        lock: '!inline ask_campaign_info.inline_script.lock'
        language: deno
        path: hub/8713/windmill/default_arguments_in_approval_steps
        tag: ''
      continue_on_error: false
      suspend:
        hide_cancel: false
        required_events: 1
        resume_form:
          schema:
            $schema: 'https://json-schema.org/draft/2020-12/schema'
            type: object
            order:
              - instructions
              - campaign_info
            properties:
              campaign_info:
                type: object
                description: ''
              instructions:
                type: string
                description: ''
                default: ''
            required: []
        timeout: 1800
    - id: cr
      summary: get campaign_info
      value:
        type: rawscript
        content: '!inline get_campaign_info.inline_script.native.ts'
        input_transforms:
          campaign_info:
            type: javascript
            expr: resume.campaign_info
        lock: ''
        language: nativets
        tag: ''
    - id: bt
      summary: Fetch leadmagic api key
      value:
        type: flow
        input_transforms: {}
        path: f/bluewind/ask_leadmagic_api_key
    - id: di
      summary: get contacts to outreach
      value:
        type: flow
        input_transforms:
          campaign_name:
            type: javascript
            expr: results.bp.name
          number_of_contacts_needed:
            type: javascript
            expr: flow_input.email_remaining_to_schedule * 2
          twenty_api_key:
            type: javascript
            expr: '`${results.bx.twenty_api_key}`'
        path: f/bluewind/get_contacts_to_outreach
    - id: dl
      summary: get only 20 records
      value:
        type: rawscript
        content: '!inline get_only_20_records.inline_script.native.ts'
        input_transforms:
          data:
            type: javascript
            expr: results.di.data.people.edges
        lock: ''
        language: nativets
        tag: ''
    - id: cg
      summary: ''
      value:
        type: branchone
        branches:
          - summary: ''
            modules:
              - id: cc
                summary: source leads from apollo
                value:
                  type: flow
                  input_transforms:
                    campaign_name:
                      type: javascript
                      expr: '`${results.bp.name}`'
                    twenty_api_key:
                      type: javascript
                      expr: '`${results.bx.twenty_api_key}`'
                  path: f/bluewind/source_leads_from_apollo
              - id: dj
                summary: get contacts to outreach
                value:
                  type: flow
                  input_transforms:
                    campaign_name:
                      type: javascript
                      expr: results.bp.name
                    number_of_contacts_needed:
                      type: static
                    twenty_api_key:
                      type: javascript
                      expr: '`${results.bx.twenty_api_key}`'
                  path: f/bluewind/get_contacts_to_outreach
            expr: results.di.data.people.edges.length === 0
            parallel: true
            skip_failure: true
        default:
          - id: cn
            summary: get contacts
            value:
              type: rawscript
              content: '!inline get_contacts.inline_script.native.ts'
              input_transforms:
                contacts:
                  type: javascript
                  expr: results.di
              lock: ''
              language: nativets
              tag: ''
    - id: bl
      value:
        type: forloopflow
        modules:
          - id: cs
            summary: outreach pipeline
            value:
              type: flow
              input_transforms:
                campaign_info:
                  type: javascript
                  expr: results.cr.campaign_info
                contact:
                  type: javascript
                  expr: flow_input.iter.value.node
                leadmagic_api_key:
                  type: javascript
                  expr: '`${results.bt.correct_leadmagic_api_key}`'
                smartlead_api_key:
                  type: javascript
                  expr: '`${results.cu.smartlead_api_key}`'
                smartlead_campaign_id:
                  type: javascript
                  expr: results.cz.smartlead_campaign_id
                twenty_api_key:
                  type: javascript
                  expr: '`${results.bx.twenty_api_key}`'
              path: f/bluewind/outreach_pipeline
        iterator:
          type: javascript
          expr: results.cg.data.people.edges
        parallel: true
        parallelism: 2
        skip_failures: true
  failure_module:
    id: failure
    value:
      type: identity
schema:
  $schema: 'https://json-schema.org/draft/2020-12/schema'
  type: object
  order:
    - email_remaining_to_schedule
  properties:
    email_remaining_to_schedule:
      type: number
      description: ''
      nullable: false
  required: []
visible_to_runner_only: false
ws_error_handler_muted: false
