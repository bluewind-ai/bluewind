summary: Master flow
description: ''
value:
  modules:
    - id: dt
      summary: Get last_twenty_migration
      value:
        type: rawscript
        content: '!inline get_last_twenty_migration.inline_script.native.ts'
        input_transforms: {}
        lock: ''
        language: nativets
    - id: bx
      summary: Fetch twenty api key
      value:
        type: flow
        input_transforms: {}
        path: f/bluewind/fetch_twenty_api_key
    - id: cu
      summary: fetch smartlead api key
      value:
        type: flow
        input_transforms: {}
        path: f/bluewind/fetch_smartlead_api_key
    - id: dp
      value:
        type: whileloopflow
        modules:
          - id: dm
            summary: count email scheduled
            value:
              type: flow
              input_transforms:
                twenty_api_key:
                  type: javascript
                  value: '${results.bx.twenty_api_key}'
                  expr: '`${results.bx.twenty_api_key}`'
              path: f/bluewind/count_emails_scheduled
          - id: dr
            summary: ''
            value:
              type: branchone
              branches:
                - summary: ''
                  modules:
                    - id: ds
                      summary: schedule more emails until 10
                      value:
                        type: flow
                        input_transforms:
                          email_remaining_to_schedule:
                            type: javascript
                            expr: >-
                              Math.max(10 - results.dm.data.people.totalCount,
                              5)
                        path: f/bluewind/schedule_more_emails
                  expr: |
                    results.dm.data.people.totalCount < 10
              default:
                - id: dn
                  summary: get email accounts
                  value:
                    type: rawscript
                    content: '!inline get_email_accounts.inline_script.native.ts'
                    input_transforms:
                      smartlead_api_key:
                        type: javascript
                        expr: results.cu.smartlead_api_key
                    language: nativets
                    tag: null
                - id: do
                  summary: ''
                  value:
                    type: branchone
                    branches:
                      - summary: ''
                        modules: []
                        expr: >-
                          results.dm.data.people.totalCount > results.dn.length
                          * 300
                    default:
                      - id: dq
                        summary: schedule more emails
                        value:
                          type: flow
                          input_transforms: {}
                          path: f/bluewind/schedule_more_emails
        skip_failures: false
  failure_module:
    id: failure
    value:
      type: identity
schema:
  $schema: 'https://json-schema.org/draft/2020-12/schema'
  type: object
  order: []
  properties: {}
  required: []
visible_to_runner_only: false
ws_error_handler_muted: false
