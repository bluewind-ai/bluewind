{% extends "admin/base_site.html" %}
{% load i18n unfold static %}

{% block extrahead %}
    {{ block.super }}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.12/themes/default/style.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.12/jstree.min.js"></script>
    <style>
        body, html { margin: 0 !important; padding: 0 !important; overflow: hidden !important; }
        #header, #container, #content, #content-main {
            padding: 0 !important;
            margin: 0 !important;
            left: 32px !important;
            position: absolute !important;
            width: calc(100% - 32px) !important;
        }
        #header { top: 0 !important; height: 40px !important; }
        #container { top: 40px !important; bottom: 0 !important; overflow: auto !important; }
        .jstree-default .jstree-anchor { padding: 0 1px !important; line-height: 16px !important; height: 16px !important; }
        .jstree-default .jstree-node { min-height: 16px !important; line-height: 16px !important; }
        #tree .jstree-wholerow { height: 16px !important; }
        #tree { font-size: 8px !important; }
        .change-link { font-size: 6px !important; padding: 0 1px !important; }
    </style>
{% endblock %}

{% block content %}
    <div class="fixed left-0 top-0 h-full z-50 w-8 bg-white border-r shadow-lg overflow-hidden">
        <div class="text-[7px] px-0.5 py-0.5 border-b">Tree</div>
        <div id="tree" class="overflow-y-auto h-[calc(100%-16px)]"></div>
    </div>

    <script>
        $(function () {
            $('#tree').jstree({
                'core' : {
                    'data' : {{ tree_json|safe }},
                    'themes': {
                        'icons': false,
                        'variant': 'small',
                        'stripes': false
                    },
                    'animation': 0
                },
                'plugins': ['wholerow']
            }).on('ready.jstree', function(e, data) {
                data.instance.get_container_ul().find('li').each(function() {
                    var node = data.instance.get_node(this);
                    var changeUrl = node.data.change_url;
                    $(this).find('.jstree-anchor').first().after(
                        '<a href="' + changeUrl + '" class="change-link">âžœ</a>'
                    );
                });
            });

            $('#tree').on('click', '.jstree-anchor', function(e) {
                var node = $('#tree').jstree(true).get_node($(this));
                $('#tree').jstree(true).toggle_node(node);
            });
        });
    </script>
{% endblock %}
