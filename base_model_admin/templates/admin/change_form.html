{% extends "admin/change_form.html" %}
{% load i18n %}

{% block extrahead %}
{{ block.super }}
<link href="https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/9.9.2/jsoneditor.min.css" rel="stylesheet" type="text/css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/9.9.2/jsoneditor.min.js"></script>
<style>
    #jsoneditor {
        width: 100%;
        height: 400px;
        margin: 20px 0;
    }
</style>
{% endblock %}

{% block content %}
{{ block.super }}
<h2>General Info</h2>
<div id="jsoneditor"></div>
{% endblock %}

{% block admin_change_form_document_ready %}
{{ block.super }}
<script>
    (function($) {
        $(document).ready(function() {
            const container = document.getElementById("jsoneditor");
            const options = {
                mode: 'code',
                modes: ['code', 'form', 'text', 'tree', 'view'],
            };
            const editor = new JSONEditor(container, options);

            // Set initial JSON
            const initialJson = {{ initial_json|default:"{}" | safe }};
            editor.set(initialJson);

            // Add event listener for the form submission
            $('form').on('submit', function(e) {
                const jsonData = editor.get();
                $('<input>').attr({
                    type: 'hidden',
                    name: 'general_info',
                    value: JSON.stringify(jsonData)
                }).appendTo($(this));
            });
        });
    })(django.jQuery);
</script>
{% endblock %}